<section class="body">
  <%= minimal_form_for [current_property, current_collection] do |f| %>
    <div class="block aside">

      <div class="collection-builder" data-level="0"
           data-elements="<%= property_elements_path(current_property) %>">
      </div>

      <%= f.input :item_data, :as => :hidden,
                  :value => current_collection.item_data.to_json %>

      <aside>
        <%= f.input :title %>

        <%= f.input :collection_type_name, :as => :hidden, :readonly => true,
                    :input_html => { :value => current_collection_type.title } %>

        <%= f.simple_fields_for :field_data,
                              OpenStruct.new(f.object.field_data) do |fd| %>
          <% current_collection_type.fields.each do |field| %>
            <%= send(field.html, fd, field.html_options) %>
          <% end %>
        <% end %>
      </aside>
    </div>
    <%= f.submit "Save" %>
  <% end %>
</section>
